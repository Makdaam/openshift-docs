[[azure-resources]]
= Resources
//openshift-aro 3.11 specific

This section describes all azure resources used to build a cluster.

== Virtual Machine Scale Sets

=== ss-masters
Scale set of 3 virtual machines used for core services.
Etcd daemon and the OpenShift API Server run here among other core services.
The ARO Sync Pod also runs on one of the Master Virtual Machines.

=== ss-infra-TIMESTAMP
Scale set of 3 virtual machines used for running infrastructure pods.
Among other services running here are:

- the docker registry
- routers for applications running on openshift
- OpenShift web console
- template service broker
- cluster monitoring Prometheus (used by ARO SREs to monitor cluster health)

=== ss-compute-TIMESTAMP
Scale set of virtual machines used by customers' pods. All application pods
and build pods are scheduled on nodes within this scale set.
The number of virtual machines can be adjusted by the customer.

== Disks
All *kubernetes-dynamic-pvc-&#42;* Disks are attached to their respective
Virtual Machine for azure-disk class PVs.
Please note that PVs are wiped during normal cluster operation when a
Virtual Machine has to be replaced and shouldn't be used for long term storage.

== Public IP addresses

=== ip-apiserver
Used for OpenShift API and Web Console access, points to the *lb-apiserver*.

=== ip-outbound
Used for outbound traffic from customers' and infrastructure pods.
It's configured in the *kubernetes* load balancer.

=== kubernetes-&#42;
Used for traffic inbound to applications running in the customers' namespace.
It's configured in the *kubernetes* load balancer.

== Load Balancers
As described in the IP Addresses section the load balancer called
*lb-apiserver* is used for API access.
The load balancer called *kubernetes* is used for all other Internet traffic:
connections inbound to customers' services running on the cluster and
connections outbound from customers' pods.

== Network security groups

=== nsg-master
Applied to master nodes. Allows API access as well as SSH management access
by ARO backend management systems.

=== nsg-worker
Applied to infra and compute nodes. Allows access to the services exposed
via the *kubernetes* load balancer.


[[dns-configuration]]
== DNS configuration
There are two DNS zones which together provide the following names:
*openshift.ID.REGION.azmosa.io* DNS name which points to the *ip-apiserver*
IP address for API access and the *&#42;.apps.ID.REGION.azmosa.io* alias
which points (via CNAME) to the *kubernetes-&#42;* IP address for inbound
requests to customers' services.

== Key Vault
Key vault *kv-&#42;* stores the keys and certificates related to the cluster.

== Storage Accounts

=== sacfg
The account beginning with *sacfg* stores master node startup config, scaleset
hashes and etcd backups.

=== sareg
Account *sareg* is the docker registry storage.

=== safil
Account *safil* stores data for PVs with the azure-file storage class.

== Pods
There are some additional management pods running in an Azure Red Hat OpenShift
cluster. This section summarizes their purpose.

=== Sync pod
The Sync Pod runs on one of the master nodes, the deployment settings make sure
there's 1 instance of it running at all times. Its role is to make sure that all
managed OpenShift resources are synchronized with the desired value.

=== Customer Admin controller
This controller synchronizes the contents of the designated Azure Active
Directory group to the cluster RBAC customer-admin group. Also makes sure all
required RBAC roles are granted on the customer created namespaces.

=== Monitoring related
Cluster Monitoring Prometheus gathers monitoring data for ARO SRE.
This prometheus is not directly available to the customers, but the data
it gathers is exposed over Azure Monitoring Workspaces.
